\documentclass[a4paper]{book}
\usepackage{fullpage}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[francais]{babel}

\usepackage{latexsym}
\usepackage{fancyhdr}
\usepackage{makeidx}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{moreverb}
\usepackage{listings}

\newcommand{\altarica}{{\sc AltaRica}}

\begin{document}

\title{Master 1, Conceptions Formelles\\
Projet du module \altarica\\
Synthèse (assistée) d'un contrôleur du niveau d'une cuve}

\date{}

\author{Jolliet Louis \and Sicardon Louis \and Vigneau Paul}

\maketitle

\chapter{Le sujet}
\input{tank}

\chapter{Le rapport}
Le rapport est sur 20 points.

\section{Rôle du fichier {\tt GNUmakefile} (2 points)}
Le makefile effectue les calcules suivants : \\
Pour tout les controleurs ( {\tt Ctrl}, {\tt CtrlVV}) et  pour toutes les pannes (0,1,2,3), il concaténe tout les fichiers \textit{alt} dans un seul et même fichier \textit{tank.alt}.
Puis il inititialise les valeurs \textit{NBPannes} et \textit{NomControleur} dans ces fichiers et met le résultat dans un fichier \textit{test.alt} .
De la même façon, un fichier  \textit{system.spe} est créé et copié dans  \textit{test.spe} avec plusieurs variables initialisées. \\
Ensuite pour toutes les iterations (0,1,2,3,4,5),le controleur est modifié en fonction de l'itération et le calcul est lancé.
Les fichiers obtenus sont comparés et le programme coupe l'itération lorsque l'évolution stagne, c'est à dire quand deux itérations produisent un même résultat.

\section{Rôle de la constante {\tt nbFailures} et de l'assertion associée (1 point)}
La constante \textit{nbFailures} est une constante correspondant au nombre de vannes pouvant tomber en panne dans le système. Une vanne en panne est une vanne qui reste pour toujours dans son état actuel. Le système en possède trois et donc \textit{nbFailures} peut prendre les valeurs 0, 1, 2 ou 3 selon le nombre de défaillance étudiées dans le système. La contrainte $nbFailures >= (V [0].fail + V [1].fail + V [2].fail)$ présente dans le système permet de s’assurer que le nombre de défaillances dans le système actuel ne dépasse pas le nombre de défaillances autorisées. Par exemple, si on test le système avec une seule défaillance et qu'une vanne est déjà défaillante (V[x].fail = 1), cette contrainte va empécher les autres vannes de disfonctionner. 

\section{Résultats avec le contrôleur initial {\tt Ctrl}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (0.5 point)}
\lstinputlisting{Res/System0FCtrl.res}
\lstinputlisting{Res/System0FCtrl0F1I.res}
\lstinputlisting{Res/System0FCtrl0F2I.res}
%\lstinputlisting{Res/System0FCtrl0F3I.res}
%\lstinputlisting{Res/System0FCtrl0F4I.res}
\paragraph{Interprétation des résultats}
Au départ on peut voir qu'un grand nombre de transition mènent à une fermeture de la valve aval (dec10 = 9500) et celle-ci est fermée dans 80 états (out0 = 80) soit dans environ un tier d'entre eux ce qui est beaucoup car on cherche à limiter la fermeture de la valve aval et le système ne prend en compte aucune défaillance. De plus, on peut voir qu'il y a 86 niveaux critiques et 86 situations redoutées, et environ un tier des \textit{targets} mènent à un coup gagnant.
Après une itération, le controleur est plus performant. On peut voir que la valve se retrouve fermée moins souvent (out0 = 26). De plus, il n'y a aucun blocage ni aucune situation redoutée ou critique. Le taux de coups gagnants est également bien meilleur.
Apres une seconde itération, le résultat obtenu est identique au résultat précédent et l'algorithme d'arrête. Il en sera de même pour l'ensemble des résultat suivant.


\subsubsection{Avec 1 défaillance (0.5 point)}
\lstinputlisting{Res/System1FCtrl.res}
\lstinputlisting{Res/System1FCtrl1F1I.res}
\lstinputlisting{Res/System1FCtrl1F2I.res}
\lstinputlisting{Res/System1FCtrl1F3I.res}
%\lstinputlisting{Res/System1FCtrl1F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER
Suite à l'ajout d'une défaillance, on remarque tout d'abord que le nombre d'états et de transitions augmentent grandement ainsi que le nombre de niveaux critiques (NC = 329) et situations redoutées (SR = 329). Malgré tout, la proportion d'état où la valve aval est fermée est approximativement la même que lorsqu'il n'y a pas de défaillance (out0 = 300 ce qui correspond environ un tier des états). En revanche, le nombre de coup gagants par rapport au nombre de targets est faible (CCoupGagnant = 4950 pour any_t = 19450 soit environ un quart seulement) et un grand nombre d'états mènent à une situation où la valve aval est fermée.



\subsubsection{Avec 2 défaillances (0.5 point)}
\lstinputlisting{Res/System2FCtrl.res}
\lstinputlisting{Res/System2FCtrl2F1I.res}
\lstinputlisting{Res/System2FCtrl2F2I.res}
\lstinputlisting{Res/System2FCtrl2F3I.res}
\lstinputlisting{Res/System2FCtrl2F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 3 défaillances (0.5 point)}
\lstinputlisting{Res/System3FCtrl.res}
\lstinputlisting{Res/System3FCtrl3F1I.res}
\lstinputlisting{Res/System3FCtrl3F2I.res}
\lstinputlisting{Res/System3FCtrl3F3I.res}
%\lstinputlisting{Res/System3FCtrl3F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsection{Calcul des contrôleurs optimisés (2 points)}
\lstinputlisting{ControleursOpt/Optimisation.alt}
% A COMPLETER en expliquant en quoi consiste l'optimisation mise en place.
Dans la description du contrôleur en 1.1.3 il est écrit que le débit de la vanne aval doit être le plus important possible.
Le fichier optimisation.alt permet de définir des priorités sur le choix des actions. On va préférer incrémenter le débit aval plupart que le laisser au même niveau et on va préférer le laisser au même niveau plutôt que le décrémenter. De ce fait, on aura toujours le débit aval qui sera le plus élevé possible.
\paragraph{Avec 0 défaillance}
\lstinputlisting{Res/System0FCtrl0F2I_Opt.res}
% A COMPLETER en analysant les contrôleurs optimisés obtenus.

\section{Construction d'un contrôleur initial plus performant}
\subsection{Rôle du composant {\tt ValveVirtual}(2 points)}
% A COMPLETER en expliquant sa sémantique et son rôle.
Le composant {\tt ValveVirtual} correspond à une valve parfaite. Il est possible d'incrémenter ou de décrémenter l'ouverture de la valve afin de laisser passer plus ou moins d'eau. La valve se stoppe (reste dans son état) dans le cas où il y aurait une défaillance.

Contrairement au composant {\tt Valve}, il ne gère pas lui même s'il y a une défaillance. Il compare les valeurs \textit{rate} et \textit{rateReal}, cette dernière valeur étant donnée par {\tt CtrlrVV}. Dans le cas où ces deux dernières valeurs sont différentes, la valve reste inactive, mais n'a pas de variable propre au caractère de blocage comme dans \tt{Valve}.

\subsection{Rôle du composant {\tt CtrlVV} (5 points)}
% A COMPLETER en expliquant les mécanismes mis en oeuvre, leurs rôles et les avantages de ce contrôleur par rapport au précédent CtrlVV.

\section{Résultats avec le contrôleur {\tt CtrlVV}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (0.5 point)}
\lstinputlisting{Res/System0FCtrlVV.res}
\lstinputlisting{Res/System0FCtrlVV0F1I.res}
\lstinputlisting{Res/System0FCtrlVV0F2I.res}
%\lstinputlisting{Res/System0FCtrlVV0F3I.res}
%\lstinputlisting{Res/System0FCtrlVV0F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 1 défaillance (0.5 point)}
\lstinputlisting{Res/System1FCtrlVV.res}
\lstinputlisting{Res/System1FCtrlVV1F1I.res}
\lstinputlisting{Res/System1FCtrlVV1F2I.res}
\lstinputlisting{Res/System1FCtrlVV1F3I.res}
\lstinputlisting{Res/System1FCtrlVV1F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 2 défaillances (0.5 point)}
\lstinputlisting{Res/System2FCtrlVV.res}
\lstinputlisting{Res/System2FCtrlVV2F1I.res}
\lstinputlisting{Res/System2FCtrlVV2F2I.res}
\lstinputlisting{Res/System2FCtrlVV2F3I.res}
%\lstinputlisting{Res/System2FCtrlVV2F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 3 défaillances (0.5 point)}
\lstinputlisting{Res/System3FCtrlVV.res}
\lstinputlisting{Res/System3FCtrlVV3F1I.res}
\lstinputlisting{Res/System3FCtrlVV3F2I.res}
\lstinputlisting{Res/System3FCtrlVV3F3I.res}
%\lstinputlisting{Res/System3FCtrlVV3F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsection{Calcul des contrôleurs optimisés (2 points)}
% A COMPLETER en analysant les contrôleurs optimisés obtenus.
\paragraph{Avec 0 défaillance}\ \\
\lstinputlisting{Res/System0FCtrlVV0F2I_Opt.res}

\paragraph{Avec 1 défaillance}\ \\
\lstinputlisting{Res/System1FCtrlVV1F4I_Opt.res}

\paragraph{Avec 2 défaillances}\ \\
\lstinputlisting{Res/System2FCtrlVV2F3I_Opt.res}

\paragraph{Avec 3 défaillances}\ \\
\lstinputlisting{Res/System3FCtrlVV3F3I_Opt.res}

\section{Conclusion (2 points)}
% A COMPLETER

\end{document}
